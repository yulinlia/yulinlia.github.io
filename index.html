<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">


























<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2">

<link rel="stylesheet" href="/css/main.css?v=7.0.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.0.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.0.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.0.0" color="#222">







<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.0.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false,"dimmer":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">






  <link rel="canonical" href="http://yoursite.com/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Hexo</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="default">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Hexo</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/02/26/How-to-implement-a-iOS-calendar-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2019/02/26/How-to-implement-a-iOS-calendar-1/" class="post-title-link" itemprop="url">How to implement a iOS calendar(1)</a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2019-02-26 15:40:02 / Modified: 15:46:00" itemprop="dateCreated datePublished" datetime="2019-02-26T15:40:02-08:00">2019-02-26</time>
            

            
              

              
            
          </span>

          

          
            
            
              
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
            
                <span class="post-meta-item-text">Comments: </span>
                <a href="/2019/02/26/How-to-implement-a-iOS-calendar-1/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count disqus-comment-count" data-disqus-identifier="2019/02/26/How-to-implement-a-iOS-calendar-1/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Recently I found a light and simple calendar app <em>Continuo</em>, which could help us keep track of our day-to-day activities. So I’m trying to implement a similar application by myself, and the first step is to implement a calendar.</p>
<h4 id="What-we-need-to-implement-a-Calendar"><a href="#What-we-need-to-implement-a-Calendar" class="headerlink" title="What we need to implement a Calendar"></a>What we need to implement a Calendar</h4><p>Actually Apple doesn’t provide a calendar component for us. So we can either create one by ourselves or use one already developed. And I decided to create a calendar component.</p>
<p>For the <strong>UI</strong>:</p>
<p><strong>UICollectionView</strong> is the best way to be the container of a calendar. Each section is a month, and each cell represent a day.</p>
<p>For the <strong>datas</strong>:</p>
<p>We need to know how many days per month? What day of the way is a first day in a specific week? NSCalendar encapsulates all information about the systems of calendar, so we will use it to prepare the data source of our collectionview.</p>
<hr>
<h4 id="How-to-use-NSCalendar-to-get-date-information-we-need"><a href="#How-to-use-NSCalendar-to-get-date-information-we-need" class="headerlink" title="How to use NSCalendar to get date information we need"></a>How to use NSCalendar to get date information we need</h4><ol>
<li><p>The number of weeks in a specific month (Including some dates don’t belong to this month)</p>
<ul>
<li><p>Get the first date in this month</p>
<p><img src="/Users/yulin/Documents/docs/Calendar_1/firstDate.jpeg" alt="firstDate"></p>
</li>
<li><p>Get the last date in this month</p>
<p><img src="/Users/yulin/Documents/docs/Calendar_1/lastDate.png" alt="image-20190225111139575"></p>
</li>
<li><p>Calculate the length of week between this two dates</p>
<p><img src="/Users/yulin/Documents/docs/Calendar_1/lengthOfWeek.png" alt="image-20190225111218875"></p>
</li>
</ul>
</li>
<li><p>Get all dates in a specific month</p>
<ul>
<li><p>After getting the total number of week, the total number of dates in this month should be the <strong>number of week * 7</strong> which including some dates belong to previous month or next month. So we need to know the weekday of the first date.</p>
<p><img src="/Users/yulin/Documents/docs/Calendar_1/weekday.png" alt="weekday"></p>
</li>
<li><p>Run loop from 0 to total number of days. Use the distance between current day and first date in this month as the day offset, then calculate its exact date.</p>
<p><img src="/Users/yulin/Documents/docs/Calendar_1/exactDates.png" alt="image-20190225113013879"></p>
</li>
<li><p>Since there are some dates belong to previous month and next month, when we display all dates, we can check if current date belong to current month, otherwise hidden the date.</p>
</li>
</ul>
</li>
</ol>
<h4 id="Display-dates"><a href="#Display-dates" class="headerlink" title="Display dates"></a>Display dates</h4><ul>
<li><p>Data structure</p>
<p>After completing the previous step, we can get dates in months. Then we can use UICollectionView to display all dates as we want. As we talked before, each month is a separate section, and every date could be a cell. I decide to use a NSMutableArray to store sections information and use a NSMutableDictionary to store cell infomartion(Key is a specific month, and value is a NSMutableArray which contains all dates)</p>
</li>
<li><p>Scrolling to append previous months or next months</p>
<p>Initially, we only display 12 months, scrolling to the top will trigger to append 6 previous months and the bottom to append 6 next months.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView</span><br></pre></td></tr></table></figure>
<p>The method above could help us to detect the scroll of UICollectionView, so we can add our logic in the function.</p>
<p><img src="/Users/yulin/Documents/docs/Calendar_1/scroll.png" alt="image-20190225114501030"></p>
</li>
<li><p>How to avoid shaking when appending past months</p>
<p>Scrolling to the top will add 6 previous months to the beginning of our calendar, if we do nothing, we can see the month displayed on the screen will be changed to 6 month ago. So we need to mannually scroll collection view to correct location to avoid shaking effect.</p>
<ol>
<li>Get the index of the section on the top of screen and record its content offset in the collection view.</li>
<li>Calculate its new content offset after reloading data.</li>
<li>Scroll the collection view to the distance.</li>
</ol>
</li>
</ul>
<p>  There are some methods we will use:</p>
<ol>
<li>Fetch all cells which are being displayed, we can call the method in <strong>UICollectionView</strong>:</li>
</ol>
<ul>
<li><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (NSArray&lt;__kindof UICollectionViewCell *&gt; *)visibleCells</span><br></pre></td></tr></table></figure>
</li>
</ul>
<ol start="2">
<li><p>To get the content offset of a cell, it is necessary to get the collection view layout attributes, in <strong>UICollectionViewLayout</strong>, there is a function we can use:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (nullable UICollectionViewLayoutAttributes *)layoutAttributesForItemAtIndexPath:(NSIndexPath *)indexPath;</span><br></pre></td></tr></table></figure>
</li>
<li><p>After above steps we can call a method of <strong>UIView</strong> instance to calculate the content offset of a cell:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">- (CGPoint)convertPoint:(CGPoint)point fromView:(nullable UIView *)view;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>​    <em>ps: Calculating the content offset based on <strong>collectionViewLayout</strong>, it may not be updated immediately after <strong>[collectionView reloadData]</strong>, we can call <strong>[layout invalidateLayout]</strong> and <strong>[layout prepareLayout]</strong> to force the update of collectionViewLayout.</em></p>
<p><img src="/Users/yulin/Documents/docs/Calendar_1/shift.png" alt="image-20190226112215672"></p>
<hr>
<p>In the end, we have implemented a simple infinite scrollable Calendar component. The key is to get date information by using NSCalendar.</p>
<p><img src="/Users/yulin/Documents/docs/Calendar_1/result.png" alt="image-20190226112441189"></p>

          
        
      
    </div>

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">John Doe</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              

              
                
                
                <div class="site-state-item site-state-tags">
                  
                    
                    
                      
                    
                    <span class="site-state-item-count">1</span>
                    <span class="site-state-item-name">tags</span>
                  
                </div>
              
            </nav>
          

          

          

          

          
          

          
            
          
          

        </div>
      </div>

      

      

    </div>
  </aside>
  


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.8.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.0.0</div>




        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="Total Visitors">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  

  
    <span class="post-meta-divider">|</span>
  

  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="Total Views">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>









        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  <script src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>


  


  <script src="/js/src/utils.js?v=7.0.0"></script>

  <script src="/js/src/motion.js?v=7.0.0"></script>



  
  


  <script src="/js/src/schemes/muse.js?v=7.0.0"></script>



  

  


  <script src="/js/src/bootstrap.js?v=7.0.0"></script>


  
  
  
  <script id="dsq-count-scr" src="https://.disqus.com/count.js" async></script>







  




  

  

  

  

  

  

  

  

  

  

  

  

  

</body>
</html>
